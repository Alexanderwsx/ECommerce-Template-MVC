@model ECommerce_Template_MVC.Models.ViewModel.ShoppingCartVM
@*Lorsque l'application démarre, ASP.NET Core injecte une instance
de IOptions<StripeSettings> dans la vue en utilisant l'injection
	de dépendance. Cette instance peut ensuite être utilisée dans
	la vue pour accéder aux valeurs de configuration de Stripe,
	telles que la clé d'API et d'autres paramètres de configuration.*@
@using Microsoft.Extensions.Options
@*@inject IOptions<ECommerce.Utility.StripeSettings> Stripe
*@

    <script>
        "use strict";

        function initMap() {
            const CONFIGURATION = {
                "ctaTitle": "Checkout",
                "mapOptions": { "center": { "lat": 37.4221, "lng": -122.0841 }, "fullscreenControl": true, "mapTypeControl": false, "streetViewControl": true, "zoom": 11, "zoomControl": true, "maxZoom": 22, "mapId": "" },
                "mapsApiKey": "YOUR_API_KEY_HERE",
                "capabilities": { "addressAutocompleteControl": true, "mapDisplayControl": false, "ctaControl": true }
            };
            const componentForm = [
                'OrderHeader_StreetAddress',
                'OrderHeader_City',
                'OrderHeader_State',
                'OrderHeader_Country',
                'OrderHeader_PostalCode',
            ];

            const getFormInputElement = (component) => document.getElementById(component);
        const autocompleteInput = getFormInputElement('OrderHeader_StreetAddress');
            const autocomplete = new google.maps.places.Autocomplete(autocompleteInput, {
                fields: ["address_components", "geometry", "name"],
                types: ["address"],
            });
            autocomplete.addListener('place_changed', function () {
                const place = autocomplete.getPlace();
                if (!place.geometry) {
                    // User entered the name of a Place that was not suggested and
                    // pressed the Enter key, or the Place Details request failed.
                    window.alert('No details available for input: \'' + place.name + '\'');
                    return;
                }
                fillInAddress(place);
            });

            function fillInAddress(place) {  // optional parameter
                const addressNameFormat = {
                    'street_number': 'short_name',
                    'route': 'long_name',
                    'locality': 'long_name',
                    'administrative_area_level_1': 'short_name',
                    'country': 'long_name',
                    'postal_code': 'short_name',
                };
                const getAddressComp = function (type) {
                    for (const component of place.address_components) {
                        if (component.types[0] === type) {
                            return component[addressNameFormat[type]];
                        }
                    }
                    return '';
                };
                getFormInputElement('OrderHeader_StreetAddress').value = getAddressComp('street_number') + ' ' + getAddressComp('route');
                getFormInputElement('OrderHeader_City').value = getAddressComp('locality');
                getFormInputElement('OrderHeader_State').value = getAddressComp('administrative_area_level_1');
                getFormInputElement('OrderHeader_PostalCode').value = getAddressComp('postal_code');
                getFormInputElement('OrderHeader_Country').value = getAddressComp('country');
            }
        }
    </script>

<form method="post">
    <br />
    <div class="container">
        <div class="card">
            <div class="card-header bg-dark text-light ml-0">
                <div class=" row container">
                    <div class="col-6">
                        <i class="fa fa-shopping-cart"></i> &nbsp;
                        Récapitulatif de la commande
                    </div>
                    <div class="col-6 text-end">
                        <a asp-action="Index" class="btn btn-outline-info btn-sm">Retourner au panier</a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="container rounded p-2">
                    <div class="row">
                        <div class="col-12 col-lg-6 pb-4">
                            <div class="row">
                                <h4 class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="text-info">Shipping Details:</span>
                                </h4>
                            </div>
                            @if(!User.Identity.IsAuthenticated){
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Email</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.Email" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.Email" class="text-danger"></span>
                                </div>
                            </div>
                            }
                         
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Prenom</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.Prenom" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.Prenom" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Nom</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.Nom" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.Nom" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Numero de téléphone</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.PhoneNumber" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.PhoneNumber" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Pays</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.Country" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.Country" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Adresse</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.StreetAddress" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.StreetAddress" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Ville</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.City" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.City" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Province</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.State" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.State" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-3">
                                    <label>Code Postal</label>
                                </div>
                                <div class="col-9">
                                    <input asp-for="OrderHeader.PostalCode" class="form-control" required />
                                    <span asp-validation-for="OrderHeader.PostalCode" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-5 offset-lg-1">
                            <h4 class="d-flex justify-content-between align-items-center mb-3">
                                <span class="text-info">Récapitulatif de la commande:</span>
                            </h4>
                            <ul class="list-group mb-3">
                                @foreach (var details in Model.ListCart)
                                {
                                    <li class="list-group-item d-flex justify-content-between">
                                        <div>
                                            <h6 class="my-0">@details.Product.Name</h6>
                                            <small class="text-muted">Quantity: @details.Count</small>
                                        </div>
                                        <span class="text-muted">@((details.Product.Price * details.Count).ToString("c")) </span>
                                    </li>
                                }
                                <li class="list-group-item d-flex justify-content-between bg-light">
                                    <small class="text-info">Total (CAD)</small>
                                    <strong class="text-info">@Model.OrderHeader.OrderTotal.ToString("c")</strong>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="row">
                    <div class="col-12 col-md-8 pt-2">
                        <p style="color:maroon; font-size:14px;">
                            Date estimée d'arrivée:
                            @DateTime.Now.AddDays(7).ToShortDateString() - @DateTime.Now.AddDays(14).ToShortDateString()
                        </p>
                        <p class="fw-bold" style="color:red">DEMO CARTE 5454 5454 5454 5454... Vous pouvez remplir les autres champs avec n'importe quoi</p>
                    </div>
                    <div class="col-12 col-md-4">
                        <button type="submit" value="Place Order" class="btn btn-primary form-control">Passer commande</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCr8wjgSQkQ_pRRAEE5n_ap5GB4SSkL1yk&libraries=places&callback=initMap&solution_channel=GMP_QB_addressselection_v1_cAC" async defer></script>
